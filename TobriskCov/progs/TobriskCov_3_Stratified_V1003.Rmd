---
title: "Tobrisk analyses - Part III"
subtitle: "Stratified analyses"
author: "Zhi Zhou and Sebastián Peña"
date: "Octorber 3, 2023"
output:
  pdf_document:
    toc: yes
  html_document:
    toc: yes
---

```{r setup3, include=FALSE}
knitr::opts_chunk$set(echo = T,
                      eval = F,
                      include = T
)
# knitr::opts_chunk$set(echo = F
# )
```

# Part III

# Loading packages and data

## Packages

```{r packages3}
# Loading packages
library(readxl)
library(haven)
library(styler)
library(tidyverse)
library(knitr)
library(kableExtra)
library(tidyr)
library(janitor)
library(gtools)
library(ggridges)
library(ggfortify)
library(tableone)
library(pollster)
library(naniar)
library(survey)
library(survival)
library(biostat3)
library(Epi)
library(lubridate)
library(mice)
library(mitools)
library(mitml)
library(Hmisc)
library(finalfit)
```

## Load data and remove unused objects

```{r load myData3}
load("TobriskCov_Data_02102023.RData")
# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

# Stratified analyses and testing for interactions

# Stratified by sex

## Primary outcome: Uptake of two doses of COVID-19 vaccine

### Smoking

```{r Sex_StrA_PO_Smoke}
# Crude model
m1_men_StrA_PO_Smoke <- with(subset(des_final, sex == 1), 
                             svyglm(event_2doses ~ factor(smoking_status), 
                                    family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_PO_Smoke))

m1_women_StrA_PO_Smoke <- with(subset(des_final, sex == 2), 
                               svyglm(event_2doses ~ factor(smoking_status), 
                                      family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_PO_Smoke))

# Adjusted for age
m2_men_StrA_PO_Smoke <- with(subset(des_final, sex == 1), 
                             svyglm(event_2doses ~ factor(smoking_status) + 
                                      pspline(age_cont), 
                                    family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_PO_Smoke))

m2_women_StrA_PO_Smoke <- with(subset(des_final, sex == 2), 
                               svyglm(event_2doses ~ factor(smoking_status) +
                                        pspline(age_cont), 
                                      family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_PO_Smoke))

# Adjusted for confounders
m3_men_StrA_PO_Smoke <- with(subset(des_final, sex == 1), 
                             svyglm(event_2doses ~ factor(smoking_status) + 
                                      pspline(age_cont) + 
                                      factor(educ_tertiles) +
                                      factor(maritalstatus_bin) + 
                                      factor(mother_tongue) +
                                      factor(involvement_attend_j) + 
                                      factor(fs_shp_koodi), 
                                    family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_PO_Smoke))

m3_women_StrA_PO_Smoke <- with(subset(des_final, sex == 2), 
                               svyglm(event_2doses ~ factor(smoking_status) + 
                                        pspline(age_cont) + 
                                        factor(educ_tertiles) +
                                        factor(maritalstatus_bin) + 
                                        factor(mother_tongue) +
                                        factor(involvement_attend_j) + 
                                        factor(fs_shp_koodi), 
                                      family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_PO_Smoke))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_men_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_women_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_men_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_women_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_men_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_women_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) + 
           factor(sex) + pspline(age_cont), 
         family = quasipoisson()))
m2_mm_Sex_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) * factor(sex) + pspline(age_cont), 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_PO_Smoke, m2_am_Sex_StrA_PO_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) * factor(sex) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_PO_Smoke, m3_am_Sex_StrA_PO_Smoke, method = "D2")
```

### Snus

```{r Sex_StrA_PO_Snus}
# Crude model
m1_men_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_PO_Snus))
m1_women_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_PO_Snus))

# Adjusted for age
m2_men_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_PO_Snus))
m2_women_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_PO_Snus))

# Adjusted for confounders
m3_men_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_PO_Snus))

m3_women_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_PO_Snus))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_PO_Snus)), 
                    confint(MIcombine(m1_men_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_PO_Snus)), 
                    confint(MIcombine(m1_women_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_PO_Snus)), 
                    confint(MIcombine(m2_men_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_PO_Snus)), 
                    confint(MIcombine(m2_women_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_PO_Snus)), 
                    confint(MIcombine(m3_men_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_PO_Snus)), 
                    confint(MIcombine(m3_women_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
m2_mm_Sex_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_PO_Snus, m2_am_Sex_StrA_PO_Snus, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  
  svyglm(event_2doses ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_PO_Snus, m3_am_Sex_StrA_PO_Snus, method = "D2")
```

## Secondary outcome (i): Uptake of one dose of COVID-19 vaccine

### Smoking

```{r Sex_StrA_SO1_Smoke}
# Crude model
m1_men_StrA_SO1_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO1_Smoke))

m1_women_StrA_SO1_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_SO1_Smoke))

# Adjusted for age
m2_men_StrA_SO1_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO1_Smoke)

m2_women_StrA_SO1_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO1_Smoke))

# Adjusted for confounders
m3_men_StrA_SO1_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO1_Smoke))

m3_women_StrA_SO1_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO1_Smoke))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_men_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_women_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_men_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_women_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_SO1_Smoke)), 
                    confint(MIcombine(m3_men_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO1_Smoke)), 
                    confint(MIcombine(m3_women_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_SO1_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
m2_mm_Sex_StrA_SO1_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) * factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_SO1_Smoke, m2_am_Sex_StrA_SO1_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_SO1_Smoke <- with(
  des_final,
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_SO1_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) * factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_SO1_Smoke, m3_am_Sex_StrA_SO1_Smoke, method = "D2")
```

### Snus

```{r Sex_StrA_SO1_Snus}
# Crude model
m1_men_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO1_Snus))

m1_women_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_SO1_Snus))

# Adjusted for age
m2_men_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO1_Snus))

m2_women_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO1_Snus))

# Adjusted for confounders
m3_men_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO1_Snus))

m3_women_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO1_Snus))

# Obtain main estimates
kables(list(knitr::kable(
  round(exp(cbind(coef(MIcombine(m1_men_StrA_SO1_Snus)), 
                  confint(MIcombine(m1_men_StrA_SO1_Snus)))), 2)[2:3, ], 
  caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO1_Snus)), 
                    confint(MIcombine(m1_women_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Women") %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_men_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_women_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(knitr::kable(
  round(exp(cbind(coef(MIcombine(m3_men_StrA_SO1_Snus)), 
                  confint(MIcombine(m3_men_StrA_SO1_Snus)))), 2)[2:3, ], 
  caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO1_Snus)), 
                    confint(MIcombine(m3_women_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex 
m2_am_Sex_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
m2_mm_Sex_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_SO1_Snus, m2_am_Sex_StrA_SO1_Snus, method = "D2")

# Adjusted for confounders 
m3_am_Sex_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_SO1_Snus, m3_am_Sex_StrA_SO1_Smoke, method = "D2")
```

## Secondary outcome (ii): Uptake of three doses of COVID-19 vaccine

### Smoking

```{r Sex_StrA_SO2_Smoke}
# Crude model
m1_men_StrA_SO2_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO2_Smoke))

m1_women_StrA_SO2_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_SO2_Smoke))

# Adjusted for age
m2_men_StrA_SO2_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO2_Smoke))

m2_women_StrA_SO2_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_3doses ~ factor(smoking_status) +
           pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO2_Smoke))

# Adjusted for confounders
m3_men_StrA_SO2_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO2_Smoke))

m3_women_StrA_SO2_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO2_Smoke))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_SO2_Smoke)), 
                    confint(MIcombine(m1_men_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO2_Smoke)), 
                    confint(MIcombine(m1_women_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_men_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_women_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_men_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_women_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) + 
           factor(sex) + pspline(age_cont) , 
         family = quasipoisson()))
m2_mm_Sex_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) * factor(sex) +
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_SO2_Smoke, m2_am_Sex_StrA_SO2_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) * factor(sex) +
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_SO2_Smoke, m3_am_Sex_StrA_SO2_Smoke, method = "D2")
```

### Snus

```{r Sex_StrA_SO2_Snus}
# Crude model
m1_men_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO2_Snus))

m1_women_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_SO2_Snus))

# Adjusted for age
m2_men_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO2_Snus))

m2_women_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO2_Snus))

# Adjusted for confounders
m3_men_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO2_Snus))

m3_women_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO2_Snus))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_SO2_Snus)), 
                    confint(MIcombine(m1_men_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO2_Snus)), 
                    confint(MIcombine(m1_women_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Women") %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_men_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Men") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_women_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Women") %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_men_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_women_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont), 
         family = quasipoisson()))
m2_mm_Sex_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont), 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_SO2_Snus, m2_am_Sex_StrA_SO2_Snus, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_SO2_Snus, m3_am_Sex_StrA_SO2_Snus, method = "D2")
```

## Secondary outcome (iii): Interval spacing between 1st and 2nd dose of COVID-19 vaccine

### Smoking

```{r Sex_StrA_SO3_Smoke, warning=FALSE}
# Crude model
m1_men_StrA_SO3_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO3_Smoke))

m1_women_StrA_SO3_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_SO3_Smoke))

# Adjusted for age
m2_men_StrA_SO3_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO3_Smoke))

m2_women_StrA_SO3_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_20weeks12 ~ factor(smoking_status) +
           pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO3_Smoke))

# Adjusted for confounders
m3_men_StrA_SO3_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO3_Smoke))

m3_women_StrA_SO3_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO3_Smoke))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_men_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_women_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_men_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_women_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_SO3_Smoke)), 
                    confint(MIcombine(m3_men_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO3_Smoke)), 
                    confint(MIcombine(m3_women_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           factor(sex) + pspline(age_cont) , 
         family = quasipoisson()))
m2_mm_Sex_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) * factor(sex) +
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_SO3_Smoke, m2_am_Sex_StrA_SO3_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) * factor(sex) +
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_SO3_Smoke, m3_am_Sex_StrA_SO3_Smoke, method = "D2")
```

### Snus

```{r Sex_StrA_SO3_Snus}
# Crude model
m1_men_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO3_Snus))

m1_women_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO3_Snus))

# Adjusted for age
m2_men_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO3_Snus))

m2_women_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO3_Snus))

# Adjusted for confounders
m3_men_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO3_Snus))

m3_women_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO3_Snus))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_SO3_Snus)), 
                    confint(MIcombine(m1_men_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO3_Snus)), 
                    confint(MIcombine(m1_women_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_men_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_women_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_men_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_women_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Women") %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
m2_mm_Sex_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_SO3_Snus, m2_am_Sex_StrA_SO3_Snus, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_SO3_Snus, m3_am_Sex_StrA_SO3_Snus, method = "D2")
```

## Secondary outcome (iv): Interval spacing between 2nd and 3rd dose of COVID-19 vaccine

### Smoking

```{r Sex_StrA_SO4_Smoke}
# Crude model
m1_men_StrA_SO4_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO4_Smoke))

m1_women_StrA_SO4_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_women_StrA_SO4_Smoke))

# Adjusted for age
m2_men_StrA_SO4_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO4_Smoke))

m2_women_StrA_SO4_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_7months23 ~ factor(smoking_status) +
           pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO4_Smoke))

# Adjusted for confounders
m3_men_StrA_SO4_Smoke <- with(
  subset(des_final, sex == 1), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO4_Smoke))

m3_women_StrA_SO4_Smoke <- with(
  subset(des_final, sex == 2), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO4_Smoke))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_SO4_Smoke)), 
                    confint(MIcombine(m1_men_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO4_Smoke)), 
                    confint(MIcombine(m1_women_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_men_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_women_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_men_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_women_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           factor(sex) + pspline(age_cont) , 
         family = quasipoisson()))
m2_mm_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) * factor(sex) +
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_StrA_SO4_Smoke, m2_am_StrA_SO4_Smoke, method = "D2")

# Adjusted for confounders
m3_am_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) * factor(sex) +
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_StrA_SO4_Smoke, m3_am_StrA_SO4_Smoke, method = "D2")
```

### Snus

```{r Sex_StrA_SO4_Snus}
# Crude model
m1_men_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))
# summary(MIcombine(m1_men_StrA_SO4_Snus))

m1_women_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age
m2_men_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_men_StrA_SO4_Snus))

m2_women_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont), 
         family = quasipoisson()))
# summary(MIcombine(m2_women_StrA_SO4_Snus))

# Adjusted for confounders
m3_men_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 1), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_men_StrA_SO4_Snus))

m3_women_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & sex == 2), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
# summary(MIcombine(m3_women_StrA_SO4_Snus))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_men_StrA_SO4_Snus)), 
                    confint(MIcombine(m1_men_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_women_StrA_SO4_Snus)), 
                    confint(MIcombine(m1_women_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Women") %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_men_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_men_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Men") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_women_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_women_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_men_StrA_SO4_Snus)),
                    confint(MIcombine(m3_men_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Men") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_women_StrA_SO4_Snus)), 
                    confint(MIcombine(m3_women_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Women") %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjusted for age and sex
m2_am_Sex_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + 
           factor(sex) + pspline(age_cont), 
         family = quasipoisson()))
m2_mm_Sex_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) , 
         family = quasipoisson()))
testModels(m2_mm_Sex_StrA_SO4_Snus, m2_am_Sex_StrA_SO4_Snus, method = "D2")

# Adjusted for confounders
m3_am_Sex_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Sex_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) * factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Sex_StrA_SO4_Snus, m3_am_Sex_StrA_SO4_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

# Stratified by age

For age, we have categorized age before as 20-39, 40-59 and 60+ for smoking and 20-39, 40-59 and 60-74 for snus use.

## Primary outcome: Uptake of two doses of COVID-19 vaccine

### Smoking

```{r Age_StrA_PO_Smoke, warning=FALSE}
# Crude model
m1_2039_StrA_PO_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_4059_StrA_PO_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_60plus_StrA_PO_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_PO_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_PO_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_PO_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_PO_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_PO_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_PO_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_2039_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_4059_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_60plus_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_2039_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_4059_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_60plus_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_2039_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_4059_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_60plus_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) * age_cont + 
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_PO_Smoke, m2_am_Age_StrA_PO_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_PO_Smoke, m3_am_Age_StrA_PO_Smoke, method = "D2")
```

### Snus

```{r Age_StrA_PO_Snus}
# Crude model
m1_2039_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_4059_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_60plus_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) +
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_PO_Snus)), 
                    confint(MIcombine(m1_2039_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_PO_Snus)), 
                    confint(MIcombine(m1_4059_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_PO_Snus)), 
                    confint(MIcombine(m1_60plus_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_PO_Snus)), 
                    confint(MIcombine(m2_2039_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_PO_Snus)), 
                    confint(MIcombine(m2_4059_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_PO_Snus)), 
                    confint(MIcombine(m2_60plus_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_PO_Snus)), 
                    confint(MIcombine(m3_2039_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_PO_Snus)), 
                    confint(MIcombine(m3_4059_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_PO_Snus)), 
                    confint(MIcombine(m3_60plus_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction 
# Adjusted for age and sex
m2_am_Age_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) * age_cont + 
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_PO_Snus, m2_am_Age_StrA_PO_Snus, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_PO_Snus, m3_am_Age_StrA_PO_Snus, method = "D2")
```

## Secondary outcome (i): Uptake of one dose of COVID-19 vaccine

### Smoking

```{r Age_StrA_S01_Smoke, warning=FALSE}
# Crude model
m1_2039_StrA_S01_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
m1_4059_StrA_S01_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
m1_60plus_StrA_S01_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_S01_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S01_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S01_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S01_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) +
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S01_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex)+
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S01_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) +
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S01_Smoke)), 
                    confint(MIcombine(m1_2039_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S01_Smoke)), 
                    confint(MIcombine(m1_4059_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S01_Smoke)), 
                    confint(MIcombine(m1_60plus_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S01_Smoke)), 
                    confint(MIcombine(m2_2039_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S01_Smoke)), 
                    confint(MIcombine(m2_4059_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S01_Smoke)), 
                    confint(MIcombine(m2_60plus_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S01_Smoke)), 
                    confint(MIcombine(m3_2039_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S01_Smoke)), 
                    confint(MIcombine(m3_4059_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S01_Smoke)), 
                    confint(MIcombine(m3_60plus_StrA_S01_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_S01_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S01_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) * age_cont + 
           factor(sex) , 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S01_Smoke, m2_am_Age_StrA_S01_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_S01_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_S01_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_S01_Smoke, m3_am_Age_StrA_S01_Smoke, method = "D2")
```

### Snus

```{r Age_StrA_S01_Snus, warning=FALSE}
# Crude model
m1_2039_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
m1_4059_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
m1_60plus_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S01_Snus)), 
                    confint(MIcombine(m1_2039_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S01_Snus)), 
                    confint(MIcombine(m1_4059_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S01_Snus)), 
                    confint(MIcombine(m1_60plus_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S01_Snus)), 
                    confint(MIcombine(m2_2039_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S01_Snus)), 
                    confint(MIcombine(m2_4059_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S01_Snus)),
                    confint(MIcombine(m2_60plus_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S01_Snus)), 
                    confint(MIcombine(m3_2039_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S01_Snus)), 
                    confint(MIcombine(m3_4059_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S01_Snus)), 
                    confint(MIcombine(m3_60plus_StrA_S01_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted age and sex
m2_am_Age_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) * age_cont +
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S01_Snus, m2_am_Age_StrA_S01_Snus, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + age_cont + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_S01_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) * age_cont + factor(educ_tertiles) + 
           factor(sex) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_S01_Snus, m3_am_Age_StrA_S01_Snus, method = "D2")
```

## Secondary outcome (ii): Uptake of three doses of COVID-19 vaccine

### Smoking

```{r Age_StrA_S02_Smoke, warning=FALSE}
# Crude model
m1_2039_StrA_S02_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_4059_StrA_S02_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_60plus_StrA_S02_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_S02_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S02_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S02_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S02_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S02_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) +
           factor(educ_tertiles) + factor(maritalstatus_bin) +
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S02_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S02_Smoke)), 
                    confint(MIcombine(m1_2039_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S02_Smoke)), 
                    confint(MIcombine(m1_4059_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S02_Smoke)), 
                    confint(MIcombine(m1_60plus_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S02_Smoke)), 
                    confint(MIcombine(m2_2039_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S02_Smoke)), 
                    confint(MIcombine(m2_4059_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S02_Smoke)),
                    confint(MIcombine(m2_60plus_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S02_Smoke)), 
                    confint(MIcombine(m3_2039_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S02_Smoke)), 
                    confint(MIcombine(m3_4059_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S02_Smoke)), 
                    confint(MIcombine(m3_60plus_StrA_S02_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_S02_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S02_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) * age_cont + 
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S02_Smoke, m2_am_Age_StrA_S02_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_S02_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_S02_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_S02_Smoke, m3_am_Age_StrA_S02_Smoke, method = "D2")
```

### Snus

```{r Age_StrA_S02_Snus, warning=FALSE}
# Crude model
m1_2039_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_4059_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_60plus_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S02_Snus)), 
                    confint(MIcombine(m1_2039_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S02_Snus)), 
                    confint(MIcombine(m1_4059_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S02_Snus)), 
                    confint(MIcombine(m1_60plus_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S02_Snus)), 
                    confint(MIcombine(m2_2039_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S02_Snus)), 
                    confint(MIcombine(m2_4059_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S02_Snus)), 
                    confint(MIcombine(m2_60plus_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S02_Snus)), 
                    confint(MIcombine(m3_2039_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S02_Snus)), 
                    confint(MIcombine(m3_4059_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S02_Snus)), 
                    confint(MIcombine(m3_60plus_StrA_S02_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) * age_cont +
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S02_Snus, m2_am_Age_StrA_S02_Snus, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_S02_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_S02_Snus, m3_am_Age_StrA_S02_Snus, method = "D2")
```

## Secondary outcome (iii): Interval spacing between 1st and 2nd dose of COVID-19 vaccine

### Smoking

```{r Age_StrA_S03_Smoke, warning=FALSE}
# Crude model
m1_2039_StrA_S03_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_4059_StrA_S03_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_60plus_StrA_S03_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_S03_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S03_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S03_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S03_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S03_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S03_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S03_Smoke)), 
                    confint(MIcombine(m1_2039_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S03_Smoke)), 
                    confint(MIcombine(m1_4059_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S03_Smoke)), 
                    confint(MIcombine(m1_60plus_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S03_Smoke)), 
                    confint(MIcombine(m2_2039_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S03_Smoke)), 
                    confint(MIcombine(m2_4059_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S03_Smoke)), 
                    confint(MIcombine(m2_60plus_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S03_Smoke)), 
                    confint(MIcombine(m3_2039_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S03_Smoke)), 
                    confint(MIcombine(m3_4059_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S03_Smoke)), 
                    confint(MIcombine(m3_60plus_StrA_S03_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_S03_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S03_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) * age_cont + 
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S03_Smoke, m2_am_Age_StrA_S03_Smoke, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_S03_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_S03_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_S03_Smoke, m3_am_Age_StrA_S03_Smoke, method = "D2")
```

### Snus

```{r Age_StrA_S03_Snus, warning=FALSE}
## Crude model
m1_2039_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
m1_4059_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
m1_60plus_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S03_Snus)), 
                    confint(MIcombine(m1_2039_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S03_Snus)), 
                    confint(MIcombine(m1_4059_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S03_Snus)), 
                    confint(MIcombine(m1_60plus_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S03_Snus)), 
                    confint(MIcombine(m2_2039_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S03_Snus)), 
                    confint(MIcombine(m2_4059_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S03_Snus)), 
                    confint(MIcombine(m2_60plus_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S03_Snus)), 
                    confint(MIcombine(m3_2039_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S03_Snus)), 
                    confint(MIcombine(m3_4059_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S03_Snus)), 
                    confint(MIcombine(m3_60plus_StrA_S03_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) * age_cont + 
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S03_Snus, m2_am_Age_StrA_S03_Snus, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_S03_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) +
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_S03_Snus, m3_am_Age_StrA_S03_Snus, method = "D2")
```

## Secondary outcome (iv): Interval spacing between 2nd and 3rd dose of COVID-19 vaccine

### Smoking

```{r Age_StrA_S04_Smoke, warning=FALSE}
# Crude model
m1_2039_StrA_S04_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_4059_StrA_S04_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_60plus_StrA_S04_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for sex
m2_2039_StrA_S04_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S04_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S04_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S04_Smoke <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S04_Smoke <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S04_Smoke <- with(
  subset(des_final, age_cont >= 60), 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S04_Smoke)), 
                    confint(MIcombine(m1_2039_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S04_Smoke)), 
                    confint(MIcombine(m1_4059_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S04_Smoke)), 
                    confint(MIcombine(m1_60plus_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S04_Smoke)), 
                    confint(MIcombine(m2_2039_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S04_Smoke)), 
                    confint(MIcombine(m2_4059_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S04_Smoke)), 
                    confint(MIcombine(m2_60plus_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S04_Smoke)), 
                    confint(MIcombine(m3_2039_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S04_Smoke)), 
                    confint(MIcombine(m3_4059_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "40-59 years", row.names = F) %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S04_Smoke)), 
                    confint(MIcombine(m3_60plus_StrA_S04_Smoke)))), 2)[2:4, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_S04_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) + age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S04_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) * age_cont + 
           factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S04_Smoke, m2_am_Age_StrA_S04_Smoke, method = "D2")

# Adjusted for confounders
m3_am_StrA_S04_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_StrA_S04_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_StrA_S04_Smoke, m3_am_StrA_S04_Smoke, method = "D2")
```

### Snus

```{r Age_StrA_S04_Snus, warning=FALSE}
# Crude model
m1_2039_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))
m1_4059_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))
m1_60plus_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_2039_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_4059_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))
m2_60plus_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_2039_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 20, 39)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_4059_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 40, 59)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_60plus_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 60, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_2039_StrA_S04_Snus)), 
                    confint(MIcombine(m1_2039_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_4059_StrA_S04_Snus)), 
                    confint(MIcombine(m1_4059_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_60plus_StrA_S04_Snus)), 
                    confint(MIcombine(m1_60plus_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_2039_StrA_S04_Snus)), 
                    confint(MIcombine(m2_2039_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_4059_StrA_S04_Snus)), 
                    confint(MIcombine(m2_4059_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_60plus_StrA_S04_Snus)), 
                    confint(MIcombine(m2_60plus_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_2039_StrA_S04_Snus)), 
                    confint(MIcombine(m3_2039_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "20-39 years") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_4059_StrA_S04_Snus)), 
                    confint(MIcombine(m3_4059_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "40-59 years", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_60plus_StrA_S04_Snus)), 
                    confint(MIcombine(m3_60plus_StrA_S04_Snus)))), 2)[2:3, ], 
    caption = "60+", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for age and sex
m2_am_Age_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) + age_cont, 
         family = quasipoisson()))
m2_mm_Age_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) * age_cont + factor(sex), 
         family = quasipoisson()))
testModels(m2_mm_Age_StrA_S04_Snus, m2_am_Age_StrA_S04_Snus, method = "D2")

# Adjusted for confounders
m3_am_Age_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) + 
           age_cont + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Age_StrA_S04_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) * age_cont + 
           factor(educ_tertiles) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Age_StrA_S04_Snus, m3_am_Age_StrA_S04_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

# Stratified by education level

## Primary outcome: Uptake of two doses of COVID-19 vaccine

### Smoking

```{r Educ_StrA_PO_Smoke, warning=FALSE}
# Crude model
m1_lower_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_medium_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_high_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_2doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_2doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_high_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_2doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_2doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_medium_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_2doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) +
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_high_StrA_PO_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_2doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_lower_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_medium_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_high_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_lower_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_medium_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_high_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_lower_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_medium_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_high_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Educ_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(
    event_2doses ~ factor(smoking_status) * factor(educ_tertiles) + 
      pspline(age_cont) + factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi), 
    family = quasipoisson()))
testModels(m3_mm_Educ_StrA_PO_Smoke, m3_am_Educ_StrA_PO_Smoke, method = "D2")
```

### Snus

```{r Educ_StrA_PO_Snus, warning=FALSE}
# Crude model
m1_lower_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_medium_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_high_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_high_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))
m3_medium_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))
m3_high_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_PO_Snus)), 
                    confint(MIcombine(m1_lower_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_PO_Snus)), 
                    confint(MIcombine(m1_medium_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_PO_Snus)), 
                    confint(MIcombine(m1_high_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_PO_Snus)), 
                    confint(MIcombine(m2_lower_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_PO_Snus)), 
                    confint(MIcombine(m2_medium_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_PO_Snus)), 
                    confint(MIcombine(m2_high_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_PO_Snus)), 
                    confint(MIcombine(m3_lower_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_PO_Snus)), 
                    confint(MIcombine(m3_medium_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_PO_Snus)), 
                    confint(MIcombine(m3_high_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for confounders
m3_am_Educ_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) * factor(educ_tertiles) + 
           pspline(age_cont) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Educ_StrA_PO_Snus, m3_am_Educ_StrA_PO_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (i): Uptake of one doses of COVID-19 vaccine

### Smoking

```{r Educ_StrA_S01_Smoke, warning=FALSE}
# Crude model
m1_lower_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
m1_medium_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
m1_high_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_medium_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_high_StrA_SO1_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_lower_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_medium_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_high_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_lower_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_medium_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_high_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO1_Smoke)), 
                               confint(MIcombine(m3_lower_StrA_SO1_Smoke)))), 2)[2:4, ], 
               caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO1_Smoke)), 
                    confint(MIcombine(m3_medium_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO1_Smoke)), 
                    confint(MIcombine(m3_high_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction 
# Adjusted for confounders
m3_am_Educ_StrA_SO1_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) +
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO1_Smoke <- with(
  des_final, 
  svyglm(
    event_1dose ~ factor(smoking_status) * factor(educ_tertiles) + 
      pspline(age_cont) + factor(sex) + 
      factor(maritalstatus_bin) + factor(mother_tongue) + 
      factor(involvement_attend_j) + factor(fs_shp_koodi), 
    family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO1_Smoke, m3_am_Educ_StrA_SO1_Smoke, method = "D2")
```

### Snus

```{r Educ_StrA_SO1_Snus, warning=FALSE}
# Crude model
m1_lower_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
m1_medium_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
m1_high_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex 
m2_lower_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_medium_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_high_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) +
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO1_Snus)), 
                    confint(MIcombine(m1_lower_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO1_Snus)), 
                    confint(MIcombine(m1_medium_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO1_Snus)),
                    confint(MIcombine(m1_high_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_lower_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_medium_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_high_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO1_Snus)), 
                    confint(MIcombine(m3_lower_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO1_Snus)), 
                    confint(MIcombine(m3_medium_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO1_Snus)), 
                    confint(MIcombine(m3_high_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for confounders
# am for additive model; mm for multiplicative model
m3_am_Educ_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) * factor(educ_tertiles) + 
           pspline(age_cont) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO1_Snus, m3_am_Educ_StrA_SO1_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (ii): Uptake of three doses of COVID-19 vaccine

### Smoking

```{r Educ_StrA_SO2_Smoke, warning=FALSE}
# Crude model
m1_lower_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_medium_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_high_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_3doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_3doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_3doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_medium_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_high_StrA_SO2_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO2_Smoke)), 
                    confint(MIcombine(m1_lower_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO2_Smoke)),
                    confint(MIcombine(m1_medium_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO2_Smoke)), 
                    confint(MIcombine(m1_high_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_lower_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_medium_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_high_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_lower_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_medium_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_high_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Educ_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) +
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(
    event_3doses ~ factor(smoking_status) * factor(educ_tertiles) +
      factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi), 
    family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO2_Smoke, m3_am_Educ_StrA_SO2_Smoke, method = "D2")
```

### Snus

```{r Educ_StrA_SO2_Snus, warning=FALSE}
# Crude model
m1_lower_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_medium_StrA_SO2_Snus <- with(
  subset(des_final,between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_high_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) +
           factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))
m3_medium_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) +
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) +
           factor(sex), 
         family = quasipoisson()))
m3_high_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) +
           factor(sex), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO2_Snus)), 
                    confint(MIcombine(m1_lower_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO2_Snus)), 
                    confint(MIcombine(m1_medium_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO2_Snus)), 
                    confint(MIcombine(m1_high_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_lower_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_medium_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_high_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_lower_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_medium_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_high_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for confounders
m3_am_Educ_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) + 
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) * factor(educ_tertiles) + 
           factor(sex) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO2_Snus, m3_am_Educ_StrA_SO2_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (iii): Interval spacing between 1st and 2nd dose of COVID-19 vaccine

### Smoking

```{r Educ_StrA_SO3_Smoke}
# Crude model
m1_lower_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_medium_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_high_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(sex) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_medium_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(maritalstatus_bin) + 
           factor(mother_tongue) +  factor(involvement_attend_j) +
           factor(sex) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_high_StrA_SO3_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(sex) + factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_lower_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_medium_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_high_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_lower_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_medium_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_high_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO3_Smoke)), 
                    confint(MIcombine(m3_lower_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO3_Smoke)),
                    confint(MIcombine(m3_medium_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO3_Smoke)), 
                    confint(MIcombine(m3_high_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Educ_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) * factor(educ_tertiles)+ 
           pspline(age_cont) + factor(sex) + factor(maritalstatus_bin) +
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO3_Smoke, m3_am_Educ_StrA_SO3_Smoke, method = "D2")
```

### Snus

```{r Educ_StrA_SO3_Snus, warning=FALSE}
# Crude model
m1_lower_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
m1_medium_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
m1_high_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))
m3_medium_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))
m3_high_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO3_Snus)), 
                    confint(MIcombine(m1_lower_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO3_Snus)), 
                    confint(MIcombine(m1_medium_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO3_Snus)),
                    confint(MIcombine(m1_high_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_lower_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_medium_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_high_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_lower_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_medium_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_high_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for confounders
m3_am_Educ_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_20weeks12 ~ factor(snus_status) * factor(educ_tertiles) + 
           pspline(age_cont) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO3_Snus, m3_am_Educ_StrA_SO3_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (iv): Interval spacing between 2nd and 3rd dose of COVID-19 vaccine

### Smoking

```{r Educ_StrA_SO4_Smoke, warning=FALSE}
# Crude model
m1_lower_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_medium_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_high_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "lower"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_medium_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "medium"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_high_StrA_SO4_Smoke <- with(
  subset(des_final, educ_tertiles == "high"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO4_Smoke)), 
                    confint(MIcombine(m1_lower_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO4_Smoke)), 
                    confint(MIcombine(m1_medium_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO4_Smoke)), 
                    confint(MIcombine(m1_high_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_lower_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_medium_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_high_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_lower_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_medium_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_high_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()


# Testing for interaction
# Adjust confounders
m3_am_Educ_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) + 
           factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) * factor(educ_tertiles) + 
           factor(sex) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) + 
           factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO4_Smoke, m3_am_Educ_StrA_SO4_Smoke, method = "D2")
```

### Snus

```{r Educ_StrA_SO4_Snus, warning=FALSE}
# Crude model
m1_lower_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))
m1_medium_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))
m1_high_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_lower_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_medium_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_high_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_lower_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "lower"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))
m3_medium_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "medium"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))
m3_high_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & educ_tertiles == "high"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(sex), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_lower_StrA_SO4_Snus)), 
                    confint(MIcombine(m1_lower_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_medium_StrA_SO4_Snus)), 
                    confint(MIcombine(m1_medium_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_high_StrA_SO4_Snus)), 
                    confint(MIcombine(m1_high_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_lower_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_lower_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "lower") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_medium_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_medium_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_high_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_high_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_lower_StrA_SO4_Snus)), 
                    confint(MIcombine(m3_lower_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "lower") %>%
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_medium_StrA_SO4_Snus)), 
                    confint(MIcombine(m3_medium_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "medium", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_high_StrA_SO4_Snus)), 
                    confint(MIcombine(m3_high_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "high", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Test for interaction
# Adjusted for confounders
m3_am_Educ_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(educ_tertiles) +
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Educ_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) * factor(educ_tertiles) +
           pspline(age_cont) + factor(sex) + 
           factor(maritalstatus_bin) + factor(mother_tongue) +
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
testModels(m3_mm_Educ_StrA_SO4_Snus, m3_am_Educ_StrA_SO4_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

# Stratified by vaccine type

## Primary outcome: Uptake of two doses of COVID-19 vaccine

### Smoking

```{r Type_StrA_PO_Smoke, warning=FALSE}
# Crude model
m1_am_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_aa_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "both Astra Zeneca"), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_mm_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "both mRNA"), 
  svyglm(event_2doses ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_am_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_2doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_aa_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "both Astra Zeneca"), 
  svyglm(event_2doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_mm_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "both mRNA"), 
  svyglm(event_2doses ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_am_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_2doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_aa_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "both Astra Zeneca"), 
  svyglm(event_2doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_StrA_PO_Smoke <- with(
  subset(des_final, type2vac == "both mRNA"), 
  svyglm(event_2doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_am_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_am_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aa_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_aa_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mm_StrA_PO_Smoke)), 
                    confint(MIcombine(m1_mm_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_am_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_am_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aa_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_aa_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mm_StrA_PO_Smoke)), 
                    confint(MIcombine(m2_mm_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "both mRNA", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_am_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_am_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aa_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_aa_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mm_StrA_PO_Smoke)), 
                    confint(MIcombine(m3_mm_StrA_PO_Smoke)))), 2)[2:4, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type2_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(event_2doses ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(type2vac) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type2_StrA_PO_Smoke <- with(
  des_final, 
  svyglm(
    event_2doses ~ factor(smoking_status) * factor(type2vac) + 
      pspline(age_cont) + factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi)+ factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type2_StrA_PO_Smoke, m3_am_Type2_StrA_PO_Smoke, method = "D2")
```

### Snus

```{r Type_StrA_PO_Snus, warning=FALSE}
# Crude model
m1_am_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_aa_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both Astra Zeneca"), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_mm_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both mRNA"), 
  svyglm(event_2doses ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_am_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_2doses ~ factor(snus_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_aa_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both Astra Zeneca"), 
  svyglm(event_2doses ~ factor(snus_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_mm_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both mRNA"), 
  svyglm(event_2doses ~ factor(snus_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_am_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_aa_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both Astra Zeneca"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both mRNA"), 
  svyglm(event_2doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_am_StrA_PO_Snus)), 
                    confint(MIcombine(m1_am_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aa_StrA_PO_Snus)), 
                    confint(MIcombine(m1_aa_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mm_StrA_PO_Snus)), 
                    confint(MIcombine(m1_mm_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_am_StrA_PO_Snus)), 
                    confint(MIcombine(m2_am_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aa_StrA_PO_Snus)), 
                    confint(MIcombine(m2_aa_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mm_StrA_PO_Snus)), 
                    confint(MIcombine(m2_mm_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "both mRNA", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_am_StrA_PO_Snus)), 
                    confint(MIcombine(m3_am_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aa_StrA_PO_Snus)), 
                    confint(MIcombine(m3_aa_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mm_StrA_PO_Snus)), 
                    confint(MIcombine(m3_mm_StrA_PO_Snus)))), 2)[2:3, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(type2vac) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type_StrA_PO_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(
    event_2doses ~ factor(snus_status) * factor(type2vac) + 
      pspline(age_cont) + factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi)+ factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_PO_Snus, m3_am_Type_StrA_PO_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (i): Uptake of one doses of COVID-19 vaccine

### Smoking

```{r Type_StrA_S01_Smoke, warning=FALSE}
# Crude model
m1_az_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Astra Zeneca"), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
m1_md_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Moderna"), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))
m1_pz_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Pfizer"), 
  svyglm(event_1dose ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_az_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Astra Zeneca"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_md_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Moderna"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_pz_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Pfizer"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_az_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Astra Zeneca"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_md_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Moderna"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_pz_StrA_SO1_Smoke <- with(
  subset(des_final, type1vac == "Pfizer"), 
  svyglm(event_1dose ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_az_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_az_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_md_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_md_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Moderna", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_pz_StrA_SO1_Smoke)), 
                    confint(MIcombine(m1_pz_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Pfizer", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_az_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_az_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_md_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_md_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Moderna", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_pz_StrA_SO1_Smoke)), 
                    confint(MIcombine(m2_pz_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Pfizer", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_az_StrA_SO1_Smoke)), 
                    confint(MIcombine(m3_az_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_md_StrA_SO1_Smoke)), 
                    confint(MIcombine(m3_md_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Moderna", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_pz_StrA_SO1_Smoke)), 
                    confint(MIcombine(m3_pz_StrA_SO1_Smoke)))), 2)[2:4, ], 
    caption = "Pfizer", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction 
# Adjusted for confounders
m3_am_Type_StrA_SO1_Smoke <- with(
  des_final, 
  svyglm(event_1dose ~ factor(smoking_status) + factor(sex) +
           pspline(age_cont) + factor(type1vac) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Type_StrA_SO1_Smoke <- with(
  des_final, 
  svyglm(
    event_1dose ~ factor(smoking_status) * factor(type1vac) +
      factor(educ_tertiles) + pspline(age_cont) + factor(sex) + 
      factor(maritalstatus_bin) + factor(mother_tongue) + 
      factor(involvement_attend_j) + factor(fs_shp_koodi), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_SO1_Smoke, m3_am_Type_StrA_SO1_Smoke, method = "D2")
```

### Snus

```{r Type_StrA_S01_Snus, warning=FALSE}
# Crude model
m1_az_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Astra Zeneca"), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
m1_md_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Moderna"), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))
m1_pz_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Pfizer"), 
  svyglm(event_1dose ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_az_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Astra Zeneca"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_md_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Moderna"),
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_pz_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Pfizer"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_az_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Astra Zeneca"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_md_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Moderna"),
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_pz_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type1vac == "Pfizer"), 
  svyglm(event_1dose ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_az_StrA_SO1_Snus)), 
                    confint(MIcombine(m1_az_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_md_StrA_SO1_Snus)), 
                    confint(MIcombine(m1_md_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Moderna", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_pz_StrA_SO1_Snus)), 
                    confint(MIcombine(m1_pz_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Pfizer", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_az_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_az_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_md_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_md_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Moderna", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_pz_StrA_SO1_Snus)), 
                    confint(MIcombine(m2_pz_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Pfizer", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age") %>% 
  kable_classic()

kables(list(
  knitr::kable(round(exp(cbind(coef(MIcombine(m3_az_StrA_SO1_Snus)), 
                               confint(MIcombine(m3_az_StrA_SO1_Snus)))), 2)[2:3, ], 
               caption = "Astra Zeneca") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_md_StrA_SO1_Snus)), 
                    confint(MIcombine(m3_md_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Moderna", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_pz_StrA_SO1_Snus)), 
                    confint(MIcombine(m3_pz_StrA_SO1_Snus)))), 2)[2:3, ], 
    caption = "Pfizer", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction 
# Adjusted for confounders
m3_am_Type_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_1dose ~ factor(snus_status) + factor(sex) +
           pspline(age_cont) + factor(type1vac) + factor(educ_tertiles) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi), 
         family = quasipoisson()))
m3_mm_Type_StrA_SO1_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(
    event_1dose ~ factor(snus_status) * factor(type1vac) +
      factor(educ_tertiles) + pspline(age_cont) + factor(sex) + 
      factor(maritalstatus_bin) + factor(mother_tongue) + 
      factor(involvement_attend_j) + factor(fs_shp_koodi), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_SO1_Snus, m3_am_Type_StrA_SO1_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (ii): Uptake of three doses of COVID-19 vaccine

### Smoking

```{r Type_StrA_SO2_Smoke, warning=FALSE}
# Crude model
m1_aam_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_mmm_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "3 * mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))
m1_amm_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_aam_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_mmm_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "3 * mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_amm_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_aam_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mmm_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "3 * mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_amm_StrA_SO2_Smoke <- with(
  subset(des_final, type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_3doses ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aam_StrA_SO2_Smoke)), 
                    confint(MIcombine(m1_aam_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mmm_StrA_SO2_Smoke)),
                    confint(MIcombine(m1_mmm_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_amm_StrA_SO2_Smoke)), 
                    confint(MIcombine(m1_amm_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aam_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_aam_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mmm_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_mmm_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_amm_StrA_SO2_Smoke)), 
                    confint(MIcombine(m2_amm_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aam_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_aam_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mmm_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_mmm_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_amm_StrA_SO2_Smoke)), 
                    confint(MIcombine(m3_amm_StrA_SO2_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(event_3doses ~ factor(smoking_status) + factor(sex) +
           factor(type3vac) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type_StrA_SO2_Smoke <- with(
  des_final, 
  svyglm(
    event_3doses ~ factor(smoking_status) * factor(type3vac) +
      factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi) + factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_SO2_Smoke, m3_am_Type_StrA_SO2_Smoke, method = "D2")
```

### Snus

```{r Type_StrA_SO2_Snus, warning=FALSE, error=T}
# Crude model
m1_aam_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_mmm_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "3 * mRNA"), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))
m1_amm_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_3doses ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_aam_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_mmm_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "3 * mRNA"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_amm_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_3doses ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_aam_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_3doses ~ factor(snus_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mmm_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "3 * mRNA"), 
  svyglm(event_3doses ~ factor(snus_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_amm_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_3doses ~ factor(snus_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aam_StrA_SO2_Snus)), 
                    confint(MIcombine(m1_aam_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mmm_StrA_SO2_Snus)),
                    confint(MIcombine(m1_mmm_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_amm_StrA_SO2_Snus)), 
                    confint(MIcombine(m1_amm_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aam_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_aam_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mmm_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_mmm_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_amm_StrA_SO2_Snus)), 
                    confint(MIcombine(m2_amm_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aam_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_aam_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mmm_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_mmm_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_amm_StrA_SO2_Snus)), 
                    confint(MIcombine(m3_amm_StrA_SO2_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_3doses ~ factor(snus_status) + factor(sex) +
           factor(educ_tertiles) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type_StrA_SO2_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(
    event_3doses ~ factor(snus_status) * factor(educ_tertiles) +
      factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi) + factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_SO2_Snus, m3_am_Type_StrA_SO2_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (iii): Interval spacing between 1st and 2nd dose of COVID-19 vaccine

### Smoking

```{r Type_StrA_SO3_Smoke, warning=FALSE}
# Crude model
m1_am_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_aa_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "both Astra Zeneca"), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_mm_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "both mRNA"), 
  svyglm(event_20weeks12 ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_am_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_aa_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "both Astra Zeneca"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_mm_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "both mRNA"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + 
           pspline(age_cont) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_am_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_aa_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "both Astra Zeneca"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_StrA_SO3_Smoke <- with(
  subset(des_final, type2vac == "both mRNA"), 
  svyglm(event_20weeks12 ~ factor(smoking_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_am_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_am_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aa_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_aa_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mm_StrA_SO3_Smoke)), 
                    confint(MIcombine(m1_mm_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_am_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_am_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aa_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_aa_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mm_StrA_SO3_Smoke)), 
                    confint(MIcombine(m2_mm_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "both mRNA", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_am_StrA_SO3_Smoke)), 
                    confint(MIcombine(m3_am_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aa_StrA_SO3_Smoke)), 
                    confint(MIcombine(m3_aa_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mm_StrA_SO3_Smoke)), 
                    confint(MIcombine(m3_mm_StrA_SO3_Smoke)))), 2)[2:4, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(event_20weeks12 ~ factor(smoking_status) + factor(sex) + 
           pspline(age_cont) + factor(type1vac) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type_StrA_SO3_Smoke <- with(
  des_final, 
  svyglm(
    event_20weeks12 ~ factor(smoking_status) * factor(type1vac) + 
      pspline(age_cont) + factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi)+ factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_SO3_Smoke, m3_am_Type_StrA_SO3_Smoke, method = "D2")
```

### Snus

```{r Type_StrA_SO3_Snus, warning=FALSE, error=T}
# Crude model
m1_am_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
m1_aa_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both Astra Zeneca"), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))
m1_mm_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both mRNA"), 
  svyglm(event_20weeks12 ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_am_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_aa_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both Astra Zeneca"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + factor(sex), 
         family = quasipoisson()))
m2_mm_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both mRNA"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_am_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "Astra Zeneca + mRNA"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_aa_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both Astra Zeneca"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type2vac == "both mRNA"), 
  svyglm(event_20weeks12 ~ factor(snus_status) + pspline(age_cont) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + 
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_am_StrA_SO3_Snus)), 
                    confint(MIcombine(m1_am_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aa_StrA_SO3_Snus)), 
                    confint(MIcombine(m1_aa_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mm_StrA_SO3_Snus)), 
                    confint(MIcombine(m1_mm_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_am_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_am_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aa_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_aa_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mm_StrA_SO3_Snus)), 
                    confint(MIcombine(m2_mm_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "both mRNA", row.names = F) %>%
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_am_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_am_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aa_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_aa_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "both Astra Zeneca", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mm_StrA_SO3_Snus)), 
                    confint(MIcombine(m3_mm_StrA_SO3_Snus)))), 2)[2:3, ], 
    caption = "both mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_2doses ~ factor(snus_status) + factor(sex) + 
           pspline(age_cont) + factor(type2vac) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type_StrA_SO3_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(
    event_2doses ~ factor(snus_status) * factor(type2vac) + 
      pspline(age_cont) + factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi)+ factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_SO3_Snus, m3_am_Type_StrA_SO3_Snus, method = "D2")

# Remove unnecessary objects from work space.
rm(list = ls()[!ls() %in% c("des_final")])
```

## Secondary outcome (iv): Interval spacing between 2nd and 3rd dose of COVID-19 vaccine

### Smoking

```{r Type_StrA_SO4_Smoke, warning=FALSE, error=T}
# Crude model
m1_aam_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_mmm_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "3 * mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))
m1_amm_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_aam_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_mmm_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "3 * mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_amm_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_aam_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mmm_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "3 * mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_amm_StrA_SO4_Smoke <- with(
  subset(des_final, type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_7months23 ~ factor(smoking_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aam_StrA_SO4_Smoke)), 
                    confint(MIcombine(m1_aam_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mmm_StrA_SO4_Smoke)),
                    confint(MIcombine(m1_mmm_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_amm_StrA_SO4_Smoke)), 
                    confint(MIcombine(m1_amm_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aam_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_aam_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mmm_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_mmm_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_amm_StrA_SO4_Smoke)), 
                    confint(MIcombine(m2_amm_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aam_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_aam_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mmm_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_mmm_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_amm_StrA_SO4_Smoke)), 
                    confint(MIcombine(m3_amm_StrA_SO4_Smoke)))), 2)[2:4, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(event_7months23 ~ factor(smoking_status) + factor(sex) +
           factor(type3vac) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type_StrA_SO4_Smoke <- with(
  des_final, 
  svyglm(
    event_7months23 ~ factor(smoking_status) * factor(type3vac) +
      factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi) + factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type_StrA_SO4_Smoke, m3_am_Type_StrA_SO4_Smoke, method = "D2")
```

### Snus

```{r Type_StrA_SO4_Snus, warning=FALSE}
# Crude model
m1_aam_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))
m1_mmm_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "3 * mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))
m1_amm_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status), 
         family = quasipoisson()))

# Adjusted for age and sex
m2_aam_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_mmm_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "3 * mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))
m2_amm_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status) + pspline(age_cont) + 
           factor(sex), 
         family = quasipoisson()))

# Adjusted for confounders
m3_aam_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "2 * Astra Zeneca + mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_mmm_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "3 * mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) + 
           factor(educ_tertiles), 
         family = quasipoisson()))
m3_amm_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74) & type3vac == "Astra Zeneca + 2 * mRNA"), 
  svyglm(event_7months23 ~ factor(snus_status) + 
           factor(maritalstatus_bin) + factor(mother_tongue) + 
           factor(involvement_attend_j) + factor(sex) + factor(fs_shp_koodi) +
           factor(educ_tertiles), 
         family = quasipoisson()))

# Obtain main estimates
kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_aam_StrA_SO4_Snus)), 
                    confint(MIcombine(m1_aam_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_mmm_StrA_SO4_Snus)),
                    confint(MIcombine(m1_mmm_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m1_amm_StrA_SO4_Snus)), 
                    confint(MIcombine(m1_amm_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M1: Crude model") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_aam_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_aam_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_mmm_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_mmm_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m2_amm_StrA_SO4_Snus)), 
                    confint(MIcombine(m2_amm_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M2: Adjusted for age and sex") %>% 
  kable_classic()

kables(list(
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_aam_StrA_SO4_Snus)), 
                    confint(MIcombine(m3_aam_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "2 * Astra Zeneca + mRNA") %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_mmm_StrA_SO4_Snus)), 
                    confint(MIcombine(m3_mmm_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "3 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T),
  knitr::kable(
    round(exp(cbind(coef(MIcombine(m3_amm_StrA_SO4_Snus)), 
                    confint(MIcombine(m3_amm_StrA_SO4_Snus)))), 2)[2:3, ], 
    caption = "Astra Zeneca + 2 * mRNA", row.names = F) %>% 
    kableExtra::kable_classic(full_width = T)), 
  caption = "M3: Adjusted for confounders") %>% 
  kable_classic()

# Testing for interaction
# Adjust confounders
m3_am_Type_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(event_7months23 ~ factor(snus_status) + factor(sex) +
           factor(type3vac) + factor(maritalstatus_bin) + 
           factor(mother_tongue) + factor(involvement_attend_j) +
           factor(fs_shp_koodi) + factor(educ_tertiles), 
         family = quasipoisson()))
m3_mm_Type3_StrA_SO4_Snus <- with(
  subset(des_final, between(age_cont, 20, 74)), 
  svyglm(
    event_7months23 ~ factor(snus_status) * factor(type3vac) +
      factor(sex) + factor(maritalstatus_bin) + 
      factor(mother_tongue) + factor(involvement_attend_j) + 
      factor(fs_shp_koodi) + factor(educ_tertiles), 
    family = quasipoisson()))
testModels(m3_mm_Type3_StrA_SO4_Snus, m3_am_Type_StrA_SO4_Snus, method = "D2")
```

# End of Part III
